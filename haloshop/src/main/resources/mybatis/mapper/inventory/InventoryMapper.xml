<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.company.haloshop.inventory.InventoryMapper">

	<!-- ìž…ê³  ë“±ë¡ -->
	<insert id="insertInventory">
		INSERT INTO inventory (items_id, stock_volume, inventory_volume, created_at)
		VALUES (#{itemsId}, #{stockVolume}, #{inventoryVolume}, NOW())
	</insert>

	<!-- ìž…ê³  ë‚´ì—­ ì „ì²´ ì¡°íšŒ (ìƒí’ˆëª… ì¡°ì¸) -->
	<select id="getInventoryList" resultType="map">
		SELECT i.id,
		i.items_id,
		it.name AS itemName,
		i.stock_volume,
		i.inventory_volume,
		i.created_at
		FROM inventory i
		JOIN items it ON i.items_id = it.id
		ORDER BY i.created_at DESC
	</select>

	<!-- ðŸ”¥ í˜„ìž¬ ì´ ìž¬ê³ ëŸ‰ ì¡°íšŒ -->
	<select id="getCurrentInventoryVolume" resultType="int">
		SELECT IFNULL(SUM(inventory_volume), 0)
		FROM inventory
		WHERE items_id = #{itemsId}
	</select>

	<!-- ðŸ”¥ ìž…ê³  ë‚´ì—­ ë‹¨ê±´ ì¡°íšŒ -->
	<select id="findInventoryById" parameterType="long"
		resultType="map">
		SELECT stock_volume, inventory_volume
		FROM inventory
		WHERE id = #{id}
	</select>

	<!-- ìž…ê³  ë‚´ì—­ ìˆ˜ì • -->
	<update id="updateInventory">
		UPDATE inventory
		SET stock_volume = #{stockVolume},
		inventory_volume = #{inventoryVolume},
		created_at = NOW()
		WHERE id = #{id}
	</update>


	<update id="decreaseInventoryVolume">
	    UPDATE inventory
	    SET inventory_volume = inventory_volume - #{quantity}
	    WHERE items_id = #{itemsId}
	</update>


	<!-- ìž…ê³  ë‚´ì—­ ì‚­ì œ -->
	<delete id="deleteInventory">
		DELETE FROM inventory
		WHERE id = #{id}
	</delete>

</mapper>