<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.company.haloshop.notification.NotificationMapper">

    <!-- 1. 알림 생성 -->
    <insert id="insert" parameterType="com.company.haloshop.notification.Notification" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO notification (receiver_id, entity_id, reference_id, is_read, created_at)
        VALUES (#{receiver.id}, #{entity.id}, #{referenceId}, #{isRead}, #{createdAt})
    </insert>

    <!-- 2. 본인 알림 조회 -->
    <select id="findByReceiverId" parameterType="long" resultType="com.company.haloshop.notification.Notification">
        SELECT id, receiver_id, entity_id, reference_id, is_read, created_at
        FROM notification
        WHERE receiver_id = #{receiverId}
        ORDER BY created_at DESC
    </select>

    <!-- 3. 알림 읽음 상태 업데이트 -->
    <update id="updateById" parameterType="map">
        UPDATE notification
        SET is_read = #{isRead}
        WHERE id = #{id}
    </update>

    <!-- 4. 알림 삭제 -->
    <delete id="deleteById" parameterType="long">
        DELETE FROM notification
        WHERE id = #{id}
    </delete>

</mapper>
