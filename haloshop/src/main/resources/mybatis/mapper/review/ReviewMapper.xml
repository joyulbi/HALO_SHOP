<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.company.haloshop.review.ReviewMapper">
    <!-- 리뷰 등록 -->
    <insert id="insertReview" parameterType="Review">
        insert into review (
            order_items_id, user_id, content, rating, created_at
        ) values (
            #{orderItemsId}, #{userId}, #{content}, #{rating}, now()
        )
    </insert>

    <!-- 주문건에 리뷰가 이미 있는지 확인 -->
    <select id="existsReviewForOrderItem" parameterType="long" resultType="boolean">
        select exists (
            select 1 from review where order_items_id = #{orderItemsId}
        )
    </select>

    <!-- 유저의 모든 리뷰 목록 조회 -->
    <select id="getReviewsByUserId" parameterType="long" resultType="Review">
        select * from review where user_id = #{userId}
    </select>

    <!-- 특정 주문건의 리뷰 조회 -->
    <select id="getReviewByOrderItemsId" parameterType="long" resultType="Review">
        select * from review where order_items_id = #{orderItemsId}
    </select>
</mapper>